{"version":3,"sources":["Carousel.js","Character.js","Character2.js","DebugContainer.js","EasyPIXI.js","Eyes.js","Mouth.js","PressListener.js","Touchstart.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"../lib.js","sourcesContent":["af.Events.mixTo( Carousel.prototype );\n\nfunction Carousel( opts ) {\n  \n    opts = af.defaults( opts, {\n\n        children: [], \n        childWidth: 300, \n        restEasing: 0.25, \n        grabEasing: 0.8, \n        listenerTarget: window, \n        scale: 1, \n        loop: false,\n        disableFeedback: false\n\n    } );\n\n    this.loop = opts.loop;\n\n    this.container = new PIXI.Container();\n    this.children = opts.children;\n    this.childWidth = opts.childWidth;\n\n    this.grabEasing = opts.grabEasing;\n    this.restEasing = opts.restEasing;\n\n    this.easing = this.restEasing;\n\n    this.listenerTarget = opts.listenerTarget;\n    this.disableFeedback = opts.disableFeedback;\n\n    this.grabbed = false;\n\n    this.grabTarget = 0;\n\n    this.prevButton = document.createElement( 'div' );\n    this.prevButton.className = 'puck-button prev';\n\n    this.nextButton = document.createElement( 'div' );\n    this.nextButton.className = 'puck-button next';\n    \n    container.appendChild( this.nextButton );\n    container.appendChild( this.prevButton );\n\n    this.nextListener = new PressListener( this.nextButton, this.next.bind( this ) );\n    this.prevListener = new PressListener( this.prevButton, this.prev.bind( this ) );\n\n    this.scale = opts.scale;\n\n    for ( var i = 0, l = this.children.length; i < l; i++ ) { \n        this.container.addChild( this.children[ i ] );\n    }\n\n    this.setChildWidth( this.childWidth );\n    this.bindListeners( this.listenerTarget );\n\n\n    this.setActive = af.debounce( this.setActive.bind( this ), 10, true );\n\n    this.setActive( 0 );\n\n};\n\nCarousel.prototype.bindListeners = function( target ) {\n    \n    var SWIPE_THRESH = 0.2;\n\n    var grabbedPosition;\n    var dragged = false;\n\n    var _this = this;\n\n    var dx = 0;\n    var dy = 0;\n\n    var $ = new Hammer.Manager( pixi.renderer.view, {\n        recognizers: [\n            [ Hammer.Pan, { direction: Hammer.DIRECTION_HORIZONTAL, event: 'pan', threshold: 10 } ], \n            [ Hammer.Press, { time: 5, event: 'press' } ], \n        ]\n    } );\n\n    $.on( 'press', function() {\n        dx = 0;\n        dy = 0;\n        dragged = false;\n        \n        _this.grab();\n        _this.grabTarget = _this.container.position.x;\n\n        grabbedPosition = _this.grabTarget;\n\n    } );\n\n    $.on( 'pressup', function() {\n        _this.release();\n\n    } );\n\n    $.on( 'panend', function( e ) {\n\n        _this.release();\n\n        var delta = e.deltaX / _this.scale;\n\n        if ( activeCharacter.playing ) return; //hack\n\n        if ( dy > dx ) return; \n\n        if ( -delta > 50 ) {\n            _this.next();\n        } else if ( delta > 50  ) {\n            _this.prev();\n        }\n        \n    } );\n    \n    $.on( 'pan', function( e ) {\n\n        e.preventDefault();\n        dragged = true;\n\n        dx += Math.abs(e.pointers[0].movementX);\n        dy += Math.abs(e.pointers[0].movementY);\n\n        _this.grabTarget = grabbedPosition + e.deltaX / _this.scale;\n        _this.targetXPosition = _this.grabTarget;\n\n    } );\n\n};\n\nCarousel.prototype.setChildWidth = function( cw ) {\n    \n    this.childWidth = cw;\n\n    for ( var i = 0, l = this.children.length; i < l; i++ ) { \n        var child = this.children[ i ];\n        child.position.x = i * this.childWidth;\n    }\n\n    this.setActive( this.activeChildIndex );\n\n};\n\nCarousel.prototype.setActive = function( index ) {\n\n    this.activeChildIndex = index;\n    this.targetXPosition = -this.activeChildIndex * this.childWidth;\n\n    this.fire( 'change', index );\n\n    this.prevButton.classList.toggle( 'hidden', this.activeChildIndex === 0 );\n    this.nextButton.classList.toggle( 'hidden', this.activeChildIndex === this.children.length - 1 );\n\n};\n\nCarousel.prototype.grab = function() {\n\n    this.grabbed = true;\n\n};\n\nCarousel.prototype.release = function() {\n    \n    this.grabbed = false;\n\n};\n\nCarousel.prototype.grabMove = function( x ) {\n    \n    this.container.position.x = x;\n\n};\n\nCarousel.prototype.next = function() {\n\n        \n    var index= this.activeChildIndex + 1;\n\n    if ( this.loop ) {\n        index %= this.children.length;\n    } else { \n        index = Math.min( this.children.length - 1, index );\n    }\n\n\n    this.setActive( index );\n\n\n};\n\nCarousel.prototype.prev = function() {\n    \n        \n    var index= this.activeChildIndex - 1;\n\n    if ( this.loop ) {\n        if ( index < 0 ) {\n            index += this.children.length;\n        }\n    } else { \n        index = Math.max( index, 0 );\n    }\n\n    this.setActive( index );\n\n\n};\n\nCarousel.prototype.update = function() {\n  \n    var target = this.grabbed ? this.grabTarget : ( -this.activeChildIndex * this.childWidth );\n    this.easing = this.grabbed ? ( this.disableFeedback ? 0 : 0.5 ) : this.restEasing;\n\n    var delta = ( target - this.container.position.x );\n    var ad = Math.abs( delta );\n\n    if ( ad > 0 && ad < 1 ) {\n        this.container.position.x = target;\n    } else { \n        this.container.position.x += delta * this.easing;\n    }\n\n\n};\n\nCarousel.prototype.arrive = function() {\n    var target = this.grabbed ? this.grabTarget : this.targetXPosition;\n    this.container.position.x = target;\n};","function Character( opts ) {\n    \n    this.container = DebugContainer();\n\n    this.style = {\n        stretch: 0, \n        open: 0, \n        vibrato: 0, \n    };\n\n    this.body = {\n\n        top: DebugContainer( opts.body.top ), \n        middle: DebugContainer( opts.body.middle ), \n        bottom: DebugContainer( opts.body.bottom )\n\n    };\n\n    this.shadow = new PIXI.Graphics();\n\n    this.shadow.beginFill( 0xefefef );\n    this.shadow.drawEllipse( 0, 0, 150, 30 );\n    this.shadow.endFill();\n\n    this.shadow.position.y = 60;\n\n    this.container.addChild( this.shadow );\n\n\n    this.bodyContainer = new PIXI.Container();\n\n\n\n    // legs\n\n    \n    this.legs = { \n        left: this.makeLimb( 0, -55, 70, 115 ),\n        right: this.makeLimb( 0, -55, 70, 115 ),\n    }\n    \n    this.armDistance = 250;\n\n    this.arms = { \n        left: this.makeLimb( -this.armDistance, -225, 70, 100 ),\n        right: this.makeLimb( this.armDistance, -225, 70, 100 ),\n    }\n\n    this.legContainer = new PIXI.Container();\n\n    this.jumpContainer = new PIXI.Container();\n    this.jumpContainer.addChild( this.legContainer );\n    this.jumpContainer.addChild( this.bodyContainer );\n\n    this.container.addChild( this.jumpContainer );\n\n    this.legContainer.addChild( this.legs.left );\n    this.legContainer.addChild( this.legs.right );\n\n    this.armContainer = new PIXI.Container();\n    this.bodyContainer.addChild( this.armContainer );\n\n    this.armContainer.addChild( this.arms.left );\n    this.armContainer.addChild( this.arms.right );\n\n    if ( this.body.top ) this.bodyContainer.addChild( this.body.top );\n    if ( this.body.middle ) this.bodyContainer.addChild( this.body.middle );\n    if ( this.body.bottom ) this.bodyContainer.addChild( this.body.bottom );\n\n    // eyes\n\n    this.eyes = new Eyes();\n    this.eyesRestY = -this.body.middle.height + 140;\n    this.eyes.container.position.y = this.eyesRestY;\n\n    this.bodyContainer.addChild( this.eyes.container );\n\n    // mouth\n\n    this.mouth = new Mouth( opts.mouth );\n    this.mouthRestY = -this.body.middle.height / 3;\n\n    this.mouth.container.position.y = this.mouthRestY;\n\n    this.bodyContainer.addChild( this.mouth.container );\n    \n\n    //\n\n    this.jumpTimeline = new TimelineMax( { paused: true } );\n\n\n    this.jumpTimeline.to( this.jumpContainer, 0.1, { rotation: -0.07, ease: Quad.easeOut } );\n    this.jumpTimeline.to( this.jumpContainer, 0.15, { rotation: 0.03 } );\n    this.jumpTimeline.to( this.jumpContainer, 0.2, { rotation: 0.0, ease: Quad.easeIn } );\n\n    this.jumpTimeline.to( this.jumpContainer.position, 0.2, { y: -120, ease: Quad.easeOut }, 0 );\n    this.jumpTimeline.to( this.jumpContainer.position, 0.3, { y: 0, ease: Quad.easeIn }, 0.2 );\n    this.update();\n\n\n\n};\n\nCharacter.prototype.makeLimb = function( x, y, width, height ) {\n\n    var limb = new PIXI.Graphics();\n    limb.beginFill( 0x3bc16f );\n    limb.drawRoundedRect( -width / 2, -15, width, height, width / 2 );\n    limb.endFill();\n    limb.scale.y = 1.3;\n\n    limb.position.set( x, y -15 );\n\n    return limb;\n\n};\n\nCharacter.prototype.update = function() {\n\n    // this.style.open = 1;\n\n    var t = this.style.stretch + this.style.vibrato * 0.01;\n\n    if ( t >= 0.0 ) {\n        this.body.middle.scale.y = t *1.5 + 1;\n        this.body.middle.scale.x = 1 / ( t * 0.5 + 1 );\n    } else { \n        this.body.middle.scale.y = 1.0 - Math.sqrt( -t ) * 0.3\n        this.body.middle.scale.x = 1 / ( 1.0 - Math.sqrt( -t ) * 0.6 );\n    }\n\n    this.eyes.container.position.y = this.eyesRestY - t * 50;\n\n    this.mouth.open.visible = this.style.playing;\n\n    this.mouth.closed.scale.set( 1.0 - this.style.open );\n\n    this.mouth.container.scale.x = this.body.middle.scale.x;\n    this.mouth.container.scale.y = t * 0.2 + 1;\n\n\n    this.legs.left.scale.x = -t * 0.3 + 1;\n    this.legs.right.scale.x = -t * 0.3 + 1;\n    this.legs.left.position.x = -60 + Math.max( -0.5, t ) * 30;\n    this.legs.right.position.x = -this.legs.left.position.x;\n\n    this.bodyContainer.position.y = -t * 20;\n\n    this.shadow.scale.x = ( this.body.middle.scale.x - 1 ) * 0.5 + 1;\n    this.shadow.scale.x *= 1.0 + this.jumpContainer.position.y * 0.005\n    this.shadow.scale.y = 1.0 + this.jumpContainer.position.y * 0.005\n\n    // this.mouth.closed.scale.y = this.body.middle.scale.y ;\n    // this.mouth.closed.scale.x = ( this.body.middle.scale.y - 1 ) * 2 + 1;\n\n\n\n    var circular = -af.clamp( this.style.stretch, -1.0, -0.5 ) - 0.5;\n    circular /= 0.5;\n\n    this.mouth.container.position.y = this.mouthRestY + af.lerp( 100, 0, this.style.open ) + af.lerp( 0, 28, circular );\n\n    this.armContainer.position.y = -t * 50;\n    this.arms.left.position.x = -this.armDistance * this.body.middle.scale.x - 30 - Math.min( t, 0 ) * 30;\n    this.arms.right.position.x = -this.arms.left.position.x;\n\n    this.eyes.left.position.x = -this.eyes.right.position.x;\n    return;//\n\n    this.mouth.mask.scale.x = af.lerp( 1, 0.3 * 1.5 / this.mouth.container.scale.x, circular ) * this.style.open;\n    this.mouth.mask.scale.y = af.lerp( 1, 0.3 * 1.5, circular ) * this.style.open;\n    this.mouth.mask.position.y = af.lerp( -150, 7, circular );\n    this.mouth.black.position.y = af.lerp( 0, -40, circular );\n\n\n};","function Character2( opts ) {\n\n    opts = af.defaults( opts, {\n\n        vibratoStrength: 50,\n        minFrequency: af.url.number('min', 1),\n        maxFrequency: 1500,\n        type: 'square',\n        volume: -20,\n        color: 0x3bc16f,\n        armX: 250,\n        armY: -225,\n        armRotation: 0,\n        armSpacing: 30,\n        eyeDisplacement: 50\n    } );\n\n    this.type = opts.type;\n    this.minFrequency = opts.minFrequency;\n    this.maxFrequency = opts.maxFrequency;\n    this.color = opts.color;\n    this.volume = opts.volume;\n    this.armX = opts.armX;\n    this.armY = opts.armY;\n    this.armRotation = opts.armRotation;\n    this.armSpacing = opts.armSpacing;\n    this.eyeDisplacement = opts.eyeDisplacement;\n\n    this.cssColor = this.color.toString( 16 );\n    for ( var i = this.cssColor.length; i < 6; i++ ) {\n        this.cssColor = '0' + this.cssColor;\n    }\n\n    this.cssColor = '#' + this.cssColor;\n\n    this.map = new af.Map();\n    this.shoulderRotationNode = new af.Node( this.map, af.Node.types.ease );\n\n    this.stretchNode = new af.Node( this.map, af.Node.types.elastic );\n    this.mouthOpenNode = new af.Node( this.map, af.Node.types.elastic );\n    this.shoulderRotationNode = new af.Node( this.map, af.Node.types.ease );\n\n    // quick fix to make the global volume quiet, otherwise you get a loud pop\n    this.vol = new Tone.Volume(-50).toDestination();\n    this.vol.volume.value = 0;\n    this.osc = new Tone.Oscillator( {\n        frequency: 440,\n        type: this.type\n    } ).connect(this.vol);\n\n\n    this.vibrato = new Tone.LFO( '8n', -opts.vibratoStrength / 2, opts.vibratoStrength / 2 );\n\n    this.vibrato.connect( this.osc.detune );\n\n    if ( af.url.boolean( 'vibrato', true ) ) {\n        this.vibrato.start();\n    }\n\n    ////\n\n    this.container = DebugContainer();\n\n    this.style = {\n        stretch: 0,\n        open: 0,\n        vibrato: 0,\n    };\n\n\n    this.shadow = new PIXI.Graphics();\n\n    this.shadow.beginFill( 0xefefef );\n    this.shadow.drawEllipse( 0, 0, 150, 30 );\n    this.shadow.endFill();\n\n    this.shadow.position.y = 60;\n\n    this.container.addChild( this.shadow );\n\n    this.bodyContainer = new PIXI.Container();\n\n\n    // legs\n\n    this.legs = {\n        left: this.makeLimb( 0, -55, 70, 115 ),\n        right: this.makeLimb( 0, -55, 70, 115 ),\n    }\n\n    this.arms = {\n        left: this.makeLimb( -this.armX, this.armY, 70, 100 ),\n        right: this.makeLimb( this.armX, this.armY, 70, 100 ),\n    }\n\n    this.legContainer = new PIXI.Container();\n\n    this.jumpContainer = new PIXI.Container();\n    this.jumpContainer.addChild( this.legContainer );\n    this.jumpContainer.addChild( this.bodyContainer );\n\n    this.container.addChild( this.jumpContainer );\n\n    this.legContainer.addChild( this.legs.left );\n    this.legContainer.addChild( this.legs.right );\n\n    this.armContainer = new PIXI.Container();\n    this.bodyContainer.addChild( this.armContainer );\n\n    this.armContainer.addChild( this.arms.left );\n    this.armContainer.addChild( this.arms.right );\n\n\n    this.body = {};\n\n    for ( var i in opts.body ) {\n        this.makeBodySegment( i, opts.body[ i ] );\n    }\n\n    // eyes\n\n    this.eyes = new Eyes();\n    this.eyesRestY = -this.body.middle.height + ( opts.eyeY || 140 );\n    this.eyes.container.position.y = this.eyesRestY;\n\n    this.bodyContainer.addChild( this.eyes.container );\n\n    // mouth\n\n    this.mouth = new Mouth( opts.mouth );\n    this.mouthRestY = opts.mouthY || ( -this.body.middle.height / 3 );\n\n    this.mouth.container.position.y = this.mouthRestY;\n\n    this.bodyContainer.addChild( this.mouth.container );\n\n\n    //\n\n    this.jumpTimeline = new TimelineLite( { paused: true } );\n\n    this.jumpFrame1 = { rotation: -0.07, ease: Quad.easeOut };\n    this.jumpFrame2 = { rotation: 0.03 };\n    this.jumpFramePosition = { y: 0, ease: Quad.easeOut };\n\n\n    this.jumpTimeline.to( this.jumpContainer, 0.1, this.jumpFrame1 );\n    this.jumpTimeline.to( this.jumpContainer, 0.15, this.jumpFrame2 );\n    this.jumpTimeline.to( this.jumpContainer, 0.2, { rotation: 0.0, ease: Quad.easeIn } );\n\n    this.jumpTimeline.to( this.jumpContainer.position, 0.2, this.jumpFramePosition, 0 );\n    this.jumpTimeline.to( this.jumpContainer.position, 0.3, { y: 0, ease: Quad.easeIn }, 0.2 );\n\n\n///\n\n    this.debounceBlink = af.debounce( this.eyes.blink.bind( this.eyes ), 500, true );\n\n\n\n\n\n///\n\n\n    this.update();\n\n};\n\nCharacter2.prototype.makeBodySegment = function( key, generator ) {\n\n    var g;\n\n    if ( generator ) {\n\n        g = new PIXI.Graphics();\n        g.beginFill( this.color );\n        generator( g );\n        g.endFill();\n\n    }\n\n    this.body[ key ] = DebugContainer( g );\n    this.bodyContainer.addChild( this.body[ key ] );\n\n};\n\nCharacter2.prototype.makeLimb = function( x, y, width, height ) {\n\n    var limb = new PIXI.Graphics();\n    limb.beginFill( this.color );\n    limb.drawRoundedRect( -width / 2, -15, width, height, width / 2 );\n    limb.endFill();\n    limb.scale.y = 1.3;\n\n    limb.position.set( x, y -15 );\n\n    return limb;\n\n};\n\nCharacter2.prototype.start = function() {\n\n    this.playing = true;\n\n    if (Tone.context.state !== \"running\") {\n      Tone.start();\n    }\n\n    this.osc.volume.value = -Infinity;\n    this.osc.volume.rampTo( this.volume, 0.01 );\n\n    this.vibrato.amplitude.value = 0;\n    this.vibrato.amplitude.rampTo( 1, 0.7 );\n\n    this.osc.start( 0 );\n\n    this.stretchNode.set( {\n        k: 2.0,\n        damping: 0.3\n    } );\n\n    this.mouthOpenNode.set( {\n        k: 0.3,\n        damping: 0.67,\n        in: 1,\n        out: 0.4\n    } );\n\n    this.debounceBlink();\n\n};\n\nCharacter2.prototype.stop = function() {\n\n    this.playing = false;\n\n    this.osc.volume.exponentialRampToValueAtTime( -Infinity, \"+0.5\" );\n\n    this.stretchNode.set( {\n        in: 0,\n        k: 0.4,\n        damping: 0.67\n    } );\n\n    this.mouthOpenNode.set( {\n        in: 0,\n        // k: 1.0,\n        // damping: 0.1\n    } );\n\n    this.debounceBlink();\n\n}\n\nCharacter2.prototype.stretch = function( t ) {\n\n    this.stretchNode.signals.in.value = af.clamp( t, -1, 1 );\n\n    if ( this.stretchNode.signals.vel.value > 0.124 && this.stretchNode.signals.in.value > 0 ) {\n        this.jump();\n    }\n\n};\n\nCharacter2.prototype.jump = function() {\n\n    if ( this.jumpTimeline.isActive() ) {\n        return;\n    }\n\n    var sign = af.random.sign();\n\n    this.jumpFrame1.rotation *= sign;\n    this.jumpFrame2.rotation *= sign;\n\n    this.jumpFramePosition.y = af.random( -90, -220 );\n\n    this.jumpTimeline.timeScale( 1 );\n    this.jumpTimeline.invalidate();\n    this.jumpTimeline.restart();\n\n};\n\n// Welcome to magic number city!!!\nCharacter2.prototype.update = function() {\n\n    this.stretchNode.update();\n    this.mouthOpenNode.update();\n    this.shoulderRotationNode.update();\n\n    var t = this.stretchNode.signals.out.value;\n\n    var freq = af.cmap( t , -1, 1, this.minFrequency, this.maxFrequency );\n\n    this.currentFrequency = freq;\n\n    if ( this.playing && this.stretchNode.signals.out.updated ) {\n\n        if ( af.ua.firefox )\n            this.osc.frequency.value = freq;\n        else\n            this.osc.frequency.rampTo( freq, 0.05 );\n\n        if ( this === activeCharacter ) domFreq.innerHTML = Math.round( this.currentFrequency );\n\n    }\n\n    this.style.stretch = t;\n    this.style.open = this.mouthOpenNode.signals.out.value;\n    this.style.vibrato = this.playing ? Math.sin( Date.now() * 0.025 ) : 0;\n\n    this.style.shoulderRotation = this.shoulderRotationNode.signals.out.value;\n    this.style.shoulderRotation += af.lerp( -1.5, -0.6, t ) + this.style.vibrato * 0.1;\n    this.style.shoulderRotation *= this.style.open;\n\n    this.shoulderRotationNode.signals.in.value = Math.max( this.stretchNode.signals.vel.value * 4.0, -Math.PI * 0.5 );\n\n    var easing;\n\n    if ( this.shoulderRotationNode.signals.in.value > this.arms.right.rotation ) {\n        easing = this.playing ? af.map( t, -1, 1, 0.1, 0.1 ) : 1.0\n    } else {\n        easing = 0.6;\n    }\n\n    this.shoulderRotationNode.signals.k.value = easing;\n\n\n    this.arms.right.rotation = this.style.shoulderRotation - this.armRotation;\n    this.arms.left.rotation = - this.arms.right.rotation;\n\n    this.jumpTimeline.timeScale( af.math.cmap( t, -1, 0, 6, 1 ) );\n    // this.style.open = 1;\n\n    var t = this.style.stretch + this.style.vibrato * 0.01;\n\n    if ( t >= 0.0 ) {\n        this.body.middle.scale.y = t * 1.3 + 1;\n        this.body.middle.scale.x = 1 / ( t * 0.5 + 1 );\n        var tt = af.pointer.down ? this.stretchNode.signals.in.value : this.stretchNode.signals.out.value;\n        // this.jumpContainer.scale.set( af.math.cmap( tt, 0, 1, 1, 0.9 ) );\n    } else {\n        this.body.middle.scale.y = 1.0 - Math.sqrt( -t ) * 0.3\n        this.body.middle.scale.x = 1 / ( 1.0 - Math.sqrt( -t ) * 0.6 );\n        this.jumpContainer.scale.set( af.math.cmap( t, 0, -1, 1, 0.75 ) );\n    }\n        this.container.position.y = 180// + af.math.map( tt, 0, 1, 0, 130 );\n\n    this.eyes.container.position.y = this.eyesRestY - t * this.eyeDisplacement;\n\n    this.mouth.open.visible = this.playing;\n\n    this.mouth.closed.scale.set( 1.0 - this.style.open );\n\n    this.mouth.container.scale.x = this.body.middle.scale.x;\n\n\n    this.mouth.container.scale.y = t * 0.2 + 1;\n\n    this.legs.left.scale.x = -t * 0.3 + 1;\n    this.legs.right.scale.x = -t * 0.3 + 1;\n    this.legs.left.position.x = -60 + Math.max( -0.5, t ) * 30;\n    this.legs.right.position.x = -this.legs.left.position.x;\n\n    this.bodyContainer.position.y = -t * 20;\n\n    this.shadow.scale.x = ( this.body.middle.scale.x - 1 ) * 0.5 + 1;\n    this.shadow.scale.x *= 1.0 + this.jumpContainer.position.y * 0.003\n    this.shadow.scale.y = 1.0 + this.jumpContainer.position.y * 0.003\n\n    // this.mouth.closed.scale.y = this.body.middle.scale.y ;\n    // this.mouth.closed.scale.x = ( this.body.middle.scale.y - 1 ) * 2 + 1;\n\n    var circular = -af.clamp( this.style.stretch, -1.0, -0.5 ) - 0.5;\n    circular /= 0.5;\n\n    this.mouth.container.position.y = this.mouthRestY + af.lerp( 100, 0, this.style.open ) + af.lerp( 0, 28, circular );\n\n    this.armContainer.position.y = -t * 50;\n    this.arms.left.position.x = -this.armX * this.body.middle.scale.x - this.armSpacing - Math.min( t, 0 ) * this.armSpacing;\n    this.arms.right.position.x = -this.arms.left.position.x;\n\n    this.eyes.left.position.x = -this.eyes.right.position.x;\n\n    this.mouth.setFrequency( t );\n\n\n    if ( this.type === 'sine' ) {\n        this.mouth.container.scale.x *= t >= 0 ? 0.8 : 1\n        this.mouth.container.position.y = this.mouthRestY + af.lerp( 100, -20, this.style.open ) + af.lerp( 0, 28, circular );\n    }\n\n    if ( af.url.boolean( 'circular' ) ) {\n\n        this.mouth.mask.scale.x = af.lerp( 1, 0.3 * 1.5 / this.mouth.container.scale.x, circular ) * this.style.open;\n        this.mouth.mask.scale.y = af.lerp( 1, 0.3 * 1.5, circular ) * this.style.open;\n        this.mouth.mask.position.y = af.lerp( -150, 7, circular );\n        this.mouth.black.position.y = af.lerp( 0, -40, circular );\n\n    }\n\n\n\n};","\n\nfunction DebugContainer( child ) {\n    return child || new PIXI.Container();\n    \n    var container = new PIXI.Container();\n    if ( child ) { \n        container.addChild( child );\n    }\n    var registration = new PIXI.Sprite( af.assets( 'texture/registration@2x.png' ) );\n    registration.tint = 0xff00ff;\n    registration.alpha = 0.5;\n    registration.scale.set( 0.25 );\n    registration.pivot.set( registration.texture.width / 2, registration.texture.height / 2 );\n    container.addChild( registration );\n    return container;\n};","\nvar EasyPIXI = function( opts ) {\n    \n    opts = af.defaults( opts, {\n        \n        fullscreen: true, \n\n        width: window.innerWidth,   // ignored if fullscreen is true\n        height: window.innerHeight, // ignored if fullscreen is true\n\n        viewboxWidth: 800, \n        viewboxHeight: 600, \n\n        antialias: af.ua.pixelRatio < 2, \n        resolution: af.ua.pixelRatio, \n        backgroundColor: 0xffffff,\n        transparent: false,\n\n        container: document.getElementById( 'container' )\n\n    } );\n\n    PIXI.ticker.shared.autoStart = false;\n    PIXI.ticker.shared.stop();\n\n    this.renderer = PIXI.autoDetectRenderer( opts.width, opts.height, {\n        antialias: opts.antialias, \n        transparent: opts.transparent, \n        resolution: opts.resolution, \n        backgroundColor: opts.backgroundColor\n    } );\n\n    this.stage = new PIXI.Container();\n\n    this.viewbox = new PIXI.Container();\n    this.viewboxWidth = opts.viewboxWidth;\n    this.viewboxHeight = opts.viewboxHeight;\n\n\n    this.stage.addChild( this.viewbox );\n\n    if ( opts.fullscreen ) {\n        \n        window.addEventListener( 'resize', this.resizeFullscreen.bind( this ) );\n        this.resizeFullscreen();\n\n    } else { \n        \n        this.setSize( opts.width, opts.height );\n\n    }\n    \n    window.addEventListener( 'resize', this.updateViewbox.bind( this ) );\n    this.updateViewbox();\n    this.render();\n\n    opts.container.appendChild( this.renderer.view );\n\n};\n\nEasyPIXI.prototype.resizeFullscreen = function() {\n    \n    this.setSize( window.innerWidth, window.innerHeight );\n\n};\n\nEasyPIXI.prototype.updateViewbox = function() {\n    \n    this.viewbox.position.x = this.width / 2;\n    this.viewbox.position.y = this.height / 2;\n\n    var scale = Math.min( this.width / this.viewboxWidth, this.height / this.viewboxHeight );\n    this.viewbox.scale.set( scale );\n\n};\n\nEasyPIXI.prototype.setSize = function( width, height ) {\n    \n    this.width = width;\n    this.height = height;\n\n    this.renderer.resize( width, height );\n    this.renderer.view.style.width = width + 'px';\n    this.renderer.view.style.height = height + 'px';\n\n};\n\nEasyPIXI.prototype.render = function() {\n  \n    this.renderer.render( this.stage );\n\n};","var Eyes = function() {\n\n    this.container = new PIXI.Container();\n\n    this.left = new PIXI.Graphics();\n\n    this.left.beginFill( 0xffffff );\n    this.left.drawCircle( -42, 0, 25 );\n    this.left.endFill();\n\n    this.right = new PIXI.Graphics();\n\n    this.right.beginFill( 0xffffff );\n    this.right.drawCircle( 42, 0, 25 );\n    this.right.endFill();\n\n    this.mask = new PIXI.Graphics();\n    this.mask.beginFill();\n    this.mask.drawRect( -400, -25, 800, 50 );\n    this.mask.endFill();\n    \n\n    this.container.addChild( this.mask );\n    this.container.addChild( this.left );\n    this.container.addChild( this.right );\n\n    this.left.mask = this.mask;\n    this.right.mask = this.mask;\n\n    var open = 1;\n\n    Object.defineProperty( this, 'open', {\n\n        get: function() {\n            return open;\n        }, \n\n        set: function( b ) {\n            open = b;\n            this.mask.scale.y = open;\n        }\n\n    } );\n\n    this.blinkTimeline = new TimelineLite( {\n        onComplete: this.onComplete, \n        onCompleteScope: this\n    } );\n\n    this.blinkTimeline.to( this, 0.075, { open: 0 } );\n    this.blinkTimeline.to( this, 0.1, { open: 1 }, '+=0.1' );\n\n};\n\nEyes.prototype.blink = function() {\n    \n    this.blinkTimeline.timeScale( 1.0 );\n    this.blinkTimeline.restart();\n\n};\n\nEyes.prototype.getRepeatDelay = function() {\n\n    var r = af.random();\n\n    return af.lerp( 4.0, 0.5, r * r * r );\n  \n};\n\nEyes.prototype.onComplete = function() {\n  \n    if ( af.random.chance( 0.1 ) ) {\n\n        // double blink\n        this.blinkTimeline.timeScale( 1.2 );\n        this.blinkTimeline.delay( 0 );\n\n    } else { \n\n        this.blinkTimeline.timeScale( af.random( 0.8, 1.1 ) );\n        this.blinkTimeline.delay( this.getRepeatDelay() );\n\n    }\n\n\n    this.blinkTimeline.restart( true );\n\n};","function Mouth( opts ) {\n\n\n\n    var tex = af.assets( opts.pattern );\n\n    this.container = DebugContainer();\n\n    this.open = DebugContainer();\n\n    this.pattern = new PIXI.extras.TilingSprite( tex, 800, 86 );\n    this.pattern.position.y = 5;\n\n    this.black = new PIXI.Graphics();\n\n    this.black.beginFill( 0x000000 );\n    this.black.drawRect( 0, 0, 800, 300 );\n    this.black.endFill();\n\n    var width = 400 * ( opts.scale || 1 );\n\n    this.mask = new PIXI.Graphics();\n    this.mask.beginFill();\n    this.mask.drawRoundedRect( -width/2, -450/2, width, 450, 200 * ( opts.scale || 1 * opts.radius || 1 ) );\n    this.mask.position.y = -150;\n    this.mask.endFill();\n\n    this.open.addChild( this.black );\n    this.open.addChild( this.pattern );\n    \n    this.black.pivot.x = ~~( this.black.width / 2 );\n    this.black.pivot.y = 60;\n\n    this.pattern.pivot.x = ~~( this.pattern.width / 2 );\n    this.pattern.pivot.y = ~~( this.pattern.height / 2 );\n\n    this.open.mask = this.mask;\n\n    var width = 30;\n    var height = 13;\n\n    this.closed = new PIXI.Graphics();\n\n    this.closed.beginFill( 0xfffffff );\n    this.closed.drawRoundedRect( -width / 2, -height / 2, width, height, height / 2 );\n    this.closed.endFill();\n\n    this.closed.position.y = -60;\n\n\n    this.container.addChild( this.mask );\n    this.container.addChild( this.closed );\n    this.container.addChild( this.open );\n\n};\n\n\nMouth.prototype.setFrequency = function( t ) {\n\n    var tt = ( t + 1 ) / 2;\n    var minSpeed = af.url.boolean( 'circular' ) ? 5 : 10;\n\n    this.pattern.tilePosition.x -= af.lerp( minSpeed, 40, Math.pow( af.clamp( tt, 0, 1 ), 2 ) );\n\n};","function PressListener( el, listener ) {\n    \n    this.el = el;\n\n    this.listener = listener;\n\n    this.onPress = this.onPress.bind( this );\n    this.onRelease = this.onRelease.bind( this );\n    \n    this.on();\n\n};\n\nPressListener.prototype.onPress = function( e ) {\n    \n    e.preventDefault();\n    \n    this.el.classList.add( 'active' );\n\n};\n\nPressListener.prototype.onRelease = function( e ) {\n    \n    e.preventDefault();\n\n    this.listener();\n    this.el.classList.remove( 'active' );\n\n};\n\nPressListener.prototype.on = function() {\n\n    this.active = true;\n  \n    this.el.addEventListener( 'touchstart', this.onPress, false );\n    this.el.addEventListener( 'touchend', this.onRelease, false );\n\n    this.el.addEventListener( 'mousedown', this.onPress, false );\n    this.el.addEventListener( 'mouseup', this.onRelease, false );\n\n};\n\nPressListener.prototype.off = function() {\n    \n    this.active = false;\n    \n    this.el.removeEventListener( 'touchstart', this.onPress, false );\n    this.el.removeEventListener( 'touchend', this.onRelease, false );\n\n    this.el.removeEventListener( 'mousedown', this.onPress, false );\n    this.el.removeEventListener( 'mouseup', this.onRelease, false );\n\n\n};","// Perform mobile touchstart operations\n(function() {\n  var ua = navigator.userAgent;\n  var isTouch = 'ontouchstart' in document.documentElement;\n  var ios = ua.match(/iPhone|iPad|iPod/i);\n  var outerDiv = document.createElement('div');\n  var innerDiv = document.createElement('div');\n\n  var style = document.createElement('style');\n  style.innerText = '#start:active, #start:focus { transform: scale(1.1); };';\n  document.head.appendChild(style);\n\n  if (isTouch) {\n    outerDiv.style.top = 0;\n    outerDiv.style.left = 0;\n    outerDiv.style.position = 'absolute';\n    outerDiv.style.height = '100%';\n    outerDiv.style.width = '100%';\n    outerDiv.style.textAlign = 'center';\n    outerDiv.style.zIndex = 99999;\n\n    innerDiv.style.borderRadius = '5px';\n    innerDiv.style.font = 'normal 4vmin/6vmin Poppins, Helvetica, Arial';\n    innerDiv.style.color = 'white';\n    innerDiv.style.margin = '0 auto';\n    innerDiv.style.zIndex = 999;\n    innerDiv.style.textAlign = 'center';\n    innerDiv.style.padding = '10px';\n\n    if (ios) {\n      innerDiv.style.background = '#707070';\n      innerDiv.style.marginTop = '15%';\n      innerDiv.style.width = '75%';\n      innerDiv.innerText = 'Heads up — if you have your iOS device in Silent Mode, audio playback is affected.';\n    } else {\n      outerDiv.style.display = 'flex';\n      outerDiv.style.alignItems = 'center';\n      outerDiv.style.background = '#fff';\n      innerDiv.style.padding = '0';\n      innerDiv.id = 'start';\n      innerDiv.style.width = '5pc';\n      innerDiv.style.height = '5pc';\n      innerDiv.style.display = 'flex';\n      innerDiv.style.alignItems = 'center';\n      innerDiv.style.justifyContent = 'center';\n      innerDiv.style.lineHeight = '5pc';\n      innerDiv.style.backgroundColor = '#fff';\n      innerDiv.style.boxShadow = '0 0 10px 0 rgba(0, 0, 0, 0.4)';\n      innerDiv.style.borderRadius = '50%';\n      innerDiv.style.color = '#646464';\n      innerDiv.style.transition = 'transform .05s ease-in';\n      innerDiv.innerHTML =\n        '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"50\" height=\"50\" viewBox=\"0 0 24 24\"><path fill=\"currentColor\" d=\"M8 5v14l11-7z\"/><path d=\"M0 0h24v24H0z\" fill=\"none\"/></svg>';\n    }\n\n    outerDiv.appendChild(innerDiv);\n    document.body.appendChild(outerDiv);\n  }\n\n  var start = !ios && isTouch ? document.querySelector('#start') : window;\n  var event = !ios && isTouch ? 'touchend' : 'touchstart';\n\n  start.addEventListener(event,\n    function firstTouch() {\n      innerDiv.style.display = 'none';\n      outerDiv.style.display = 'none';\n\n      start.removeEventListener(event, firstTouch, false);\n    },\n    false\n  );\n})();\n"]}